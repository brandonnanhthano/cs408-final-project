<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>theWait</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  
  <h1>theWait</h1>

  <nav class ="navbar">
    <a href="about.html" tabindex="0">About restaurant</a>
 </nav>
  


  <h2>Join the Waitlist</h2>
  <p>Fill out the form below to join the waitlist!</p>

  <!-- Waitlist form that uses a required at the end so that customers cannot join unless the form is completely filled out -->
  <form id="waitlist-form">
    <input type="text" id="name" placeholder="Name" required tabindex="1" />
    <input type="number" id="partySize" placeholder="Party Size" required tabindex="2" />
    <input type="text" id="phoneNumber" placeholder="Phone Number" required tabindex="3" /> 
    <button type="submit" tabindex="4">Add to Waitlist</button>
  </form>

  <h2>Current Waitlist</h2>
  <button onclick="fetchWaitlist()" tabindex="5">Refresh List</button>
  <ul id="waitlist"></ul>

  <script>
    const apiUrl = 'https://fk5t394mkb.execute-api.us-east-2.amazonaws.com/items'; //API URL for the waitlist

    document.getElementById('waitlist-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      // Pulls value from form and parses party size into a string value
      const name = document.getElementById('name').value;
      const partySize = parseInt(document.getElementById('partySize').value);
      const phoneNumber = document.getElementById('phoneNumber').value;

      const res = await fetch(apiUrl, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name, partySize, phoneNumber })
      });

      const result = await res.json();
      alert(`Added: ${result.message || result.error || 'Unknown response'}`);
      fetchWaitlist(); // auto-refresh after adding
    });

    async function fetchWaitlist() { //Pulls waitlist info from database clears and refreshes with new info 
      const res = await fetch(apiUrl);
      const data = await res.json();
      const list = document.getElementById('waitlist');
      list.innerHTML = '';

      let nextTabIndex = 6; // Start tab index for list items

      data.forEach(entry => { //loops through each data entry and creates a new list 
        const item = document.createElement('li');
        item.setAttribute('tabindex', '0'); // Makes the item list accessible through tabbing
        item.innerHTML = `
          ${entry.name} (Party of ${entry.partySize}) - ${entry.phoneNumber}
          <button onclick="deleteEntry('${entry.id}')" aria-label="Delete ${entry.name} from waitlist">X</button>
        `;
        list.appendChild(item);
      });
    }

    async function deleteEntry(id) { // Deletes entry from the waitlist
      const confirmed = confirm("Are you sure you want to delete this entry?"); //Confirmation before deleting
      if (!confirmed) return;

      const res = await fetch(`${apiUrl}/${id}`, { // Deletes entry from the waitlist
        method: 'DELETE', 
      });

      const result = await res.text();
      alert(result || 'Deleted!');
      fetchWaitlist(); // auto refresh after deleting an entry
    }

    // Auto-load waitlist on page load
    fetchWaitlist();
  </script>
</body>
</html>
